<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fleet Operations Tracker | <%= title %></title>
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body>
  <header>
    <div class="logo">
      <img src="/img/logo.jpg" alt="Team Logo" />
      <h1>Fleet Operations Tracker</h1>
    </div>

    <nav>
      <a href="/" class="<%= activePage === 'home' ? 'active' : '' %>">Home</a>
      <a href="/create" class="<%= activePage === 'create' ? 'active' : '' %>">Log New Trip</a>
      <a href="/trucks" class="<%= activePage === 'trucks' ? 'active' : '' %>">View Active Trip</a>
    </nav>
  </header>


  <main class="page-content">
    <div class="table-container">

      <% if (message) { %>
        <div class="message-box success-box"><%= message %></div>
      <% } else if (error) { %>
        <div class="message-box error-box"><%= error %></div>
      <% } %>
      
      <h2>Tracked Trucks / Trips</h2>
      <p>Below is a list of all tracked trucks currently stored in the system.</p>

      <table class="truck-table">

        <thead>
          <tr>
            <th>Trip / Route Name</th>
            <th>Truck / Unit ID</th>
            <th>Driver</th>
            <th>Scheduled Departure</th>
            <th>Estimated Arrival</th>
            <th>Status</th>
            <th>Cargo Type</th>
            <th>Weight (kg)</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>

          <% if (!trips || trips.length === 0) { %>
            <tr>
              <td colspan="9" class="no-data-cell">
                No trucks found. <a href="/create" class="table-link">Log a new trip</a>.
              </td>
            </tr>

          <% } else { %>

            <% trips.forEach(function(truck) { %>
              <tr>

                
                <td><%= truck.tripName %></td>
                <td><%= truck.truckId %></td>
                <td>
                  <% if (truck.user && truck.user.fullName) { %>
                    <%= truck.user.fullName %>
                  <% } else { %>
                    <%= truck.driverName %> 
                  <% } %>
                </td>

                <td>
                  <% if (truck.scheduledDeparture) { %>
                    <%= truck.scheduledDeparture.toISOString().substring(0, 10) %>
                  <% } else { %>
                    -
                  <% } %>
                </td>

                <td>
                  <% if (truck.estimatedArrival) { %>
                    <%= truck.estimatedArrival.toISOString().substring(0, 10) %>
                  <% } else { %>
                    -
                  <% } %>
                </td>

                <td>
                  <span class="status-badge status-<%= (truck.status || 'Scheduled').replace(/\s+/g, '-') %>">
                    <%= truck.status || 'Scheduled' %>
                  </span>
                </td>

                <td><%= truck.cargoType %></td>
                <td><%= truck.weightKg %></td>

                <td>
                  <a href="/edit-trip/<%= truck._id %>" class="table-link">View / Edit</a>
                </td>

              </tr>
            <% }); %>

          <% } %>

        </tbody>
      </table>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Fleet Operations Tracker Project. INFR3120.</p>
  </footer>

</body>
</html>